<!DOCTYPE html>
<html>

<head>
    <title>Admin Dashboard</title>
</head>

<body>
    <h1>User Management</h1>
    <h2>All Users:</h2>
    <ul>
        <% users.forEach(user => { %>
            <li>
                <%= user.username %> - <%= user.email %>
                <% if (user.isApproved) { %>
                    <span>- <strong>Approved</strong></span>
                <% } else { %>
                    <form method="POST" action="/admin/approve/<%= user._id %>" onsubmit="return approveUser(this);" style="display: inline;">
                        <button type="submit">Approve</button>
                    </form>
                <% } %>
            </li>
        <% }) %>
    </ul>

    <script>
        async function approveUser(form) {
            try {
                const response = await fetch(form.action, { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    alert(data.message);
                    location.reload(); // page reload after approval
                } else {
                    alert("Error approving user");
                }
            } catch (err) {
                console.error("Approval error:", err);
                alert("Something went wrong!");
            }
            return false; // prevent default form submit
        }
    </script>
</body>

</html>
